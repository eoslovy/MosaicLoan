spring:
  application:
    name: springcloud-gateway
  profiles:
    active: docker

jwt:
  secret: ${JWT_SECRET}

logging:
  level:
    org.springframework.cloud.gateway: TRACE
    org.springframework.cloud.gateway.handler.RoutePredicateHandlerMapping: DEBUG
    org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter: DEBUG
    org.springframework.web: DEBUG
    reactor.netty.http.server: DEBUG
    reactor.netty.http.client: DEBUG
    org.springframework.security: DEBUG
---
spring:
  config:
    activate:
      on-profile: docker

  cloud:
    gateway:
      default-filters:
        - AddResponseHeader=X-GATEWAY, docker
      routes:
        - id: health-check
          uri: http://member-api:8080
          predicates:
            - Path=/health
          filters:
            - PreserveHostHeader
        
        - id: no-security-api
          uri: http://member-api:8080
          predicates:
            - Path=/no-security/**,/simple-test/**,/test/**,/api/test/**,/v3/api-docs/**,/swagger-ui/**
          filters:
            - PreserveHostHeader
            
        - id: simple-test-api
          uri: http://member-api:8080
          predicates:
            - Path=/simple-test
            
        - id: test-api-public
          uri: http://member-api:8080
          predicates:
            - Path=/api/test/public/**
          filters:
            - StripPrefix=2

        - id: test-api
          uri: http://member-api:8080
          predicates:
            - Path=/api/test/**
          filters:
            - StripPrefix=2
            - name: JwtAuthentication

        - id: auth-api
          uri: http://member-api:8080
          predicates:
            - Path=/auth/**

        - id: member-api
          uri: http://member-api:8080
          predicates:
            - Path=/api/members/**
          filters:
            - PreserveHostHeader
            - StripPrefix=2
            - name: JwtAuthentication

        - id: account-api
          uri: http://account-api:8080
          predicates:
            - Path=/api/account/**
          filters:
            - StripPrefix=2
            - name: JwtAuthentication

        - id: contract-api
          uri: http://contract-api:8080
          predicates:
            - Path=/api/contract/**
          filters:
            - StripPrefix=2
            - name: JwtAuthentication

        - id: mydata-api
          uri: http://mydata-api:8080
          predicates:
            - Path=/api/mydata/**
          filters:
            - StripPrefix=2
            - name: JwtAuthentication

        - id: credit-api
          uri: http://credit-api:8080
          predicates:
            - Path=/api/credit/**
          filters:
            - StripPrefix=2
            - name: JwtAuthentication

server:
  port: 8080

---
spring:
  config:
    activate:
      on-profile: k8s

  cloud:
    gateway:
      default-filters:
        - AddResponseHeader=X-GATEWAY, k8s
        - name: JwtAuthentication
      routes:
        - id: member-service
          uri: http://member-service.mosaic.svc.cluster.local:8080
          predicates:
            - Path=/api/member/**
          filters:
            - StripPrefix=2
            - name: JwtAuthentication

        - id: account-service
          uri: http://account-service.mosaic.svc.cluster.local:8080
          predicates:
            - Path=/api/account/**
          filters:
            - StripPrefix=2
            - name: JwtAuthentication

        - id: contract-service
          uri: http://contract-service.mosaic.svc.cluster.local:8080
          predicates:
            - Path=/api/contract/**
          filters:
            - StripPrefix=2
            - name: JwtAuthentication

        - id: mydata-service
          uri: http://mydata-service.mosaic.svc.cluster.local:8080
          predicates:
            - Path=/api/mydata/**
          filters:
            - StripPrefix=2
            - name: JwtAuthentication

        - id: credit-service
          uri: http://credit-service.mosaic.svc.cluster.local:8080
          predicates:
            - Path=/api/credit/**
          filters:
            - StripPrefix=2
            - name: JwtAuthentication

server:
  port: 8080
